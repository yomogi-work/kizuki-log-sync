<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kizuki-Log Dashboard</title>
    <link rel="stylesheet" href="style.css?v=3">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <header>
            <div class="logo">
                <h1>Kizuki-Log</h1>
                <span class="subtitle">〜薬局実習の「徒然なる学び」を翻訳する〜</span>
            </div>
            <div class="student-selector">
                <label for="student-select">学生を選択:</label>
                <select id="student-select">
                    <!-- Options will be populated by JS -->
                </select>
            </div>
        </header>

        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="storyboard">全体俯瞰 (Story Board)</button>
            <button class="tab-btn" data-tab="daily">日次指導 (Daily Advice)</button>
            <button class="tab-btn" data-tab="settings">事前準備 (Settings)</button>
        </nav>

        <main>
            <!-- Story Board Tab -->
            <div id="tab-storyboard" class="tab-content active">
                <div class="storyboard-controls"
                    style="margin-bottom: 20px; display: flex; gap: 15px; align-items: center;">
                    <div class="instructor-toggle">
                        <label class="switch-label"
                            style="display: flex; align-items: center; gap: 8px; font-weight: 600; cursor: pointer;">
                            <input type="checkbox" id="instructor-mode-toggle" style="width: 20px; height: 20px;">
                            <span>👨‍🏫 指導者モード (内部スコアを表示)</span>
                        </label>
                    </div>
                    <button id="generate-weekly-btn" class="secondary-btn" style="margin: 0; padding: 8px 16px;">📊
                        今週の週次分析を生成</button>
                    <div id="weekly-loading" class="spinner-small" style="display: none;"></div>
                </div>

                <div class="story-board" id="story-board-container">
                    <!-- Dynamic Columns will be injected by JS -->
                    <div class="empty-state">設定画面で実習期間を設定すると、成長の軌跡がここに表示されます。</div>
                </div>

                <section class="ai-advice-section">
                    <div class="ai-icon">🤖</div>
                    <div id="ai-advice-content">
                        <!-- AI Advice populated here -->
                    </div>
                </section>
            </div>

            <!-- Daily Advice Tab -->
            <div id="tab-daily" class="tab-content" style="display: none;">
                <div class="daily-interface">
                    <!-- Calendar Sidebar -->
                    <div class="daily-calendar-col card">
                        <div class="header-with-icon">
                            <span class="icon">📅</span>
                            <h2>実習進捗</h2>
                        </div>
                        <div id="attendance-calendar" class="calendar-grid">
                            <!-- JS dynamically generates content -->
                        </div>
                        <div class="calendar-legend">
                            <span class="legend-item"><span class="dot filled"></span> 入力済</span>
                            <span class="legend-item"><span class="dot"></span> 未入力</span>
                        </div>
                    </div>

                    <!-- Left: Student Daily Input -->
                    <div class="daily-input-col card">
                        <div class="header-with-icon">
                            <span class="icon">📝</span>
                            <h2>今日の日誌入力</h2>
                        </div>
                        <div class="form-group-row">
                            <div class="form-group">
                                <label for="daily-date">日付:</label>
                                <input type="date" id="daily-date">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="journal-practical">具体的な実習内容</label>
                            <textarea id="journal-practical" placeholder="例：今日は糖尿病の患者さんの服薬指導を見学しました..."
                                style="height: 120px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="journal-unachieved">実習にて達成できなかった点（次回への反省・改善点）</label>
                            <textarea id="journal-unachieved" placeholder="例：患者さんの質問に即座に答えられなかった..."
                                style="height: 100px;"></textarea>
                        </div>

                        <!-- 指導者専用入力エリア -->
                        <div class="instructor-input-area">
                            <div class="header-with-icon" style="margin-top: 12px;">
                                <span class="icon">👨‍🏫</span>
                                <h3>指導者メモ（任意）</h3>
                            </div>

                            <!-- 前回の継続フラグ表示 -->
                            <div id="previous-triggers-display" class="previous-triggers-box" style="display: none;">
                                <div class="triggers-label">🔗 前回の指導ポイント（継続フラグ）:</div>
                                <div id="previous-triggers-text" class="triggers-content"></div>
                            </div>

                            <div class="form-group">
                                <label for="instructor-notes">現場で感じた学生の様子</label>
                                <textarea id="instructor-notes" placeholder="例：今日は少し緊張気味だった。患者さんとの会話で笑顔が見られた..."
                                    style="height: 80px;"></textarea>
                            </div>
                        </div>

                        <button id="analyze-btn" class="primary-btn">🤖 AI解析・保存</button>
                        <div id="analyze-loading" class="loading-indicator" style="display: none;">
                            <div class="spinner"></div>
                            <span>AIが日誌を分析しています...</span>
                        </div>
                    </div>

                    <!-- Right: AI Briefing Report -->
                    <div class="daily-coach-col">

                        <!-- ブリーフィング・レポート: 専門的洞察 -->
                        <div class="coach-card analysis-card">
                            <div class="coach-header">
                                <span class="icon">📋</span>
                                <h3>ブリーフィング・レポート</h3>
                            </div>
                            <div id="daily-analysis-result">
                                <div class="empty-state-sm">日誌を入力して解析ボタンを押してね</div>
                            </div>
                        </div>

                        <!-- 対話サポート -->
                        <div class="coach-card suggestion-card">
                            <div class="coach-header">
                                <span class="icon">💬</span>
                                <h3>対話サポート</h3>
                            </div>
                            <div id="daily-suggestions">
                                <!-- Mentoring support content -->
                            </div>
                        </div>

                        <!-- 指導シード（次回の継続ポイント） -->
                        <div class="coach-card seed-card" id="seed-selection-card" style="display: none;">
                            <div class="coach-header">
                                <span class="icon">🌱</span>
                                <h3>次回の指導シード</h3>
                            </div>
                            <p class="seed-instruction">明日確認したいポイントを1つ選んでください：</p>
                            <div id="mentoring-seeds-list">
                                <!-- Radio buttons for seeds -->
                            </div>
                            <button id="save-seed-btn" class="secondary-btn">選択したシードを保存</button>
                        </div>

                        <!-- 【NEW】研究用判定データ（Step 0 統合） -->
                        <div class="coach-card step0-card" id="step0-judgment-card"
                            style="display: none; border-left-color: #9c27b0;">
                            <div class="coach-header">
                                <span class="icon">🔬</span>
                                <h3>研究データ判定 (Step 0)</h3>
                            </div>
                            <p class="seed-instruction" style="margin-bottom: 12px;">
                                AIが抽出したトピックの「概念化レベル」と「主体」を確認・修正してください。</p>
                            <div id="step0-drafts-list" class="step0-drafts-container">
                                <!-- Draft items will be injected here by JS -->
                            </div>
                            <button id="save-step0-btn" class="primary-btn"
                                style="margin-top: 12px; width: 100%; background-color: #9c27b0;">この判定を確定して保存</button>
                        </div>

                        <!-- Feedback Input -->
                        <div class="coach-card feedback-input-card">
                            <div class="coach-header">
                                <span class="icon">✍️</span>
                                <h3>指導コメント入力</h3>
                            </div>
                            <textarea id="feedback-input" placeholder="学生への実際のフィードバックを入力..."></textarea>
                            <button id="save-feedback-btn" class="secondary-btn">コメントを保存</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Settings Tab -->
            <div id="tab-settings" class="tab-content" style="display: none;">
                <div class="settings-interface card">
                    <div class="header-with-actions">
                        <div class="header-with-icon">
                            <span class="icon">⚙️</span>
                            <h2 id="settings-title">事前準備・設定</h2>
                        </div>
                        <button id="add-new-student-btn" class="tertiary-btn">+ 新規学生を追加</button>
                    </div>

                    <section class="settings-section">
                        <h3>0. 対象学生の選択・登録</h3>
                        <div class="form-group">
                            <label for="student-name">学生氏名:</label>
                            <input type="text" id="student-name" placeholder="例：新薬 太郎（既存学生を選ぶと編集、新しい名前で新規登録）">
                        </div>
                    </section>

                    <section class="settings-section">
                        <h3>1. 実習期間の設定</h3>
                        <div class="form-group-row">
                            <div class="form-group">
                                <label for="start-date">開始日:</label>
                                <input type="date" id="start-date">
                            </div>
                            <div class="form-group">
                                <label for="end-date">終了日:</label>
                                <input type="date" id="end-date">
                            </div>
                        </div>
                    </section>

                    <section class="settings-section">
                        <h3>2. 薬局のスローガン・評価軸</h3>
                        <div class="form-group">
                            <label for="pharmacy-slogan">スローガン:</label>
                            <input type="text" id="pharmacy-slogan" placeholder="例：生活を翻訳する、徒然なる学び">
                        </div>
                        <div class="form-group">
                            <label for="focus-keywords">重点キーワード（カンマ区切り）:</label>
                            <input type="text" id="focus-keywords" placeholder="例：生活背景, 心情, 処方意図">
                        </div>
                    </section>

                    <section class="settings-section">
                        <h3>3. AIプロバイダ設定</h3>
                        <div class="form-group">
                            <label for="ai-provider-select">使用するAIエンジン:</label>
                            <select id="ai-provider-select">
                                <option value="groq">🚀 Groq (Llama 3.3 70B) — 無料・高速</option>
                                <option value="gemini">✨ Google Gemini 2.0 Flash (推奨)</option>
                                <option value="openai">🤖 OpenAI (GPT-4o) — 有料</option>
                                <option value="anthropic">🧠 Anthropic (Claude) — 有料</option>
                            </select>
                        </div>
                        <div id="ai-provider-status" class="ai-provider-status">
                            <span class="status-dot status-unknown"></span>
                            <span id="ai-status-text">接続テストボタンで確認できます</span>
                        </div>
                        <button id="test-ai-btn" class="tertiary-btn" style="margin-top: 8px;">🔌 接続テスト</button>
                    </section>

                    <section class="settings-section">
                        <h3>4. 学生個別の情報</h3>
                        <div class="form-group">
                            <label for="student-goal">今回の実習目標:</label>
                            <textarea id="student-goal" style="height: 80px;"
                                placeholder="学生本人が立てた目標や、指導者として期待すること"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="student-interests">興味・関心のある分野:</label>
                            <input type="text" id="student-interests" placeholder="例：漢方, 在宅, OTC, 多職種連携">
                        </div>
                    </section>

                    <button id="save-settings-btn" class="primary-btn">設定を保存して適用</button>
                </div>
            </div>
        </main>
    </div>
    <script src="app.js?v=3"></script>
</body>

</html>